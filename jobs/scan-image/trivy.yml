include:
  - local: jobs/scan-image/base.yml

trivy:
  extends: .scan-image
  image: 
    name: ghcr.io/defenseunicorns/swf-pipeline-templates/trivy:0.48.0-with-db
    entrypoint: [""]
  variables:
    GIT_STRATEGY: none
    TRIVY_USERNAME: "$CI_REGISTRY_USER"
    TRIVY_PASSWORD: "$CI_REGISTRY_PASSWORD"
    TRIVY_AUTH_URL: "$CI_REGISTRY"
  script:
    - trivy --version
    - trivy image --skip-update --format json --output $CONTAINER_SCAN_REPORT  --input "$ARTIFACT_FOLDER/image-as-tar/${CI_PROJECT_NAME}-${CI_COMMIT_SHORT_SHA}.tar"
